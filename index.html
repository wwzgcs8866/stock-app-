<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸£à¸°à¸šà¸šà¸ªà¸•à¹Šà¸­à¸„à¸ªà¸´à¸™à¸„à¹‰à¸²</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:sans-serif;background:#f4f6f8;margin:0;padding:15px}
h1{text-align:center}
input,select,button{width:100%;padding:10px;margin:5px 0}
.card{background:#fff;padding:10px;border-radius:8px;margin-top:10px}
img{max-width:100%;border-radius:6px;margin-top:5px}
small{color:red}
</style>
</head>
<body>

<h1>ğŸ“¦ à¸£à¸°à¸šà¸šà¸ªà¸•à¹Šà¸­à¸„à¸ªà¸´à¸™à¸„à¹‰à¸²</h1>

<input id="search" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²" oninput="render()">

<div class="card">
<input id="name" placeholder="à¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²">
<input id="code" placeholder="à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² / à¸šà¸²à¸£à¹Œà¹‚à¸„à¹‰à¸”">
<input id="price" type="number" placeholder="à¸£à¸²à¸„à¸²">
<input id="exp" type="date">

<input id="newCat" placeholder="à¹€à¸à¸´à¹ˆà¸¡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹ƒà¸«à¸¡à¹ˆ">
<select id="cat"></select>

<input type="file" accept="image/*" id="img">

<button onclick="scan()">ğŸ“· à¸ªà¹à¸à¸™à¸šà¸²à¸£à¹Œà¹‚à¸„à¹‰à¸”</button>
<button onclick="add()">â• à¹€à¸à¸´à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²</button>
</div>

<div id="list"></div>

<script>
let items = JSON.parse(localStorage.getItem("stock")||"[]");
let cats = JSON.parse(localStorage.getItem("cats")||'["à¸­à¸²à¸«à¸²à¸£","à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡"]');

function save(){
localStorage.setItem("stock",JSON.stringify(items));
localStorage.setItem("cats",JSON.stringify(cats));
}

function loadCats(){
cat.innerHTML="";
cats.forEach(c=>{
cat.innerHTML+=`<option>${c}</option>`;
});
}

function add(){
if(newCat.value && !cats.includes(newCat.value)){
cats.push(newCat.value);
}
let reader=new FileReader();
reader.onload=()=>{
items.push({
n:name.value,
c:code.value,
p:price.value,
e:exp.value,
cat:cat.value,
img:reader.result
});
save(); render();
};
if(img.files[0]) reader.readAsDataURL(img.files[0]);
else reader.onload();
}

function render(){
list.innerHTML="";
let today=new Date().toISOString().slice(0,10);
items.filter(i=>i.n.includes(search.value)||i.c.includes(search.value))
.forEach(i=>{
let warn=i.e && i.e<=today?"<small>âš  à¹ƒà¸à¸¥à¹‰à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸</small>":"";
list.innerHTML+=`<div class="card">
<b>${i.n}</b><br>
à¸£à¸«à¸±à¸ª: ${i.c}<br>
à¸£à¸²à¸„à¸²: ${i.p}<br>
à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸: ${i.e}<br>
à¸«à¸¡à¸§à¸”: ${i.cat}<br>
${warn}
${i.img?`<img src="${i.img}">`:""}
</div>`;
});
}

async function scan(){
try{
const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
alert("à¹€à¸›à¸´à¸”à¸à¸¥à¹‰à¸­à¸‡à¹à¸¥à¹‰à¸§ à¸à¸£à¸¸à¸“à¸²à¹ƒà¸Šà¹‰à¹à¸­à¸›à¸ªà¹à¸à¸™à¸šà¸²à¸£à¹Œà¹‚à¸„à¹‰à¸”à¸‚à¸­à¸‡à¸¡à¸·à¸­à¸–à¸·à¸­\nà¹à¸¥à¹‰à¸§à¸„à¸±à¸”à¸¥à¸­à¸à¸£à¸«à¸±à¸ªà¸¡à¸²à¸§à¸²à¸‡à¹ƒà¸™à¸Šà¹ˆà¸­à¸‡");
stream.getTracks().forEach(t=>t.stop());
}catch(e){alert("à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸¥à¹‰à¸­à¸‡")}
}

loadCats();
render();
</script>

</body>
</html>
